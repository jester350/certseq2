


<div class = "row">
<div class = "col-md-1"></div>
<div class = "col-md-10">

<form action="updatecert" method="post" name="updatecert" id="updatecert" encType="multipart/form-data">

    <input type="hidden" id="certid" name="certid" value="{{certid}}">
    <input type="hidden" id="certdevicejuncid" name="certdevicejuncid" value="{{certdevicejuncid}}">
    
    <div class="form-inline">
        <label for="name" class="col-sm-0 mb-2 mr-sm-2 col-form-label">Certificate Name</label>
        <div class="form-inline col-sm-3">
            <input type="text" name="name" id="name" class="form-control mb-2 mr-sm-2" readonly value="{{{certname}}}">
        </div>
        <label for="name" class="col-sm-0 col-form-label mb-2 mr-sm-2">Common Name</label>
        <div class="form-inline col-sm-2">
            <input type="text" name="commonname" id="commonname" class="form-control mb-2 mr-sm-2" value="{{{commonName}}}">
        </div>
    </div>

<br>

        <div class="form-group row">
            <label for="changeref" class="col-sm-2 col-form-label mb-2 mr-sm-2">Change Reference</label>
            <div class="col-sm-4">
                <input type="text" name="changeref" id="changeref" class="form-control mb-2 mr-sm-2" value="{{{changeref}}}">
            </div>
        </div>   

        <div class="form-group row" size="5">
            <label for="certtype" class="col-sm-2 col-form-label mb-2 mr-sm-2">Cert Type</label>
            <select name = "certtype" id="certtype" selected = {{{listcerttypename}}}>
                {{#each certlist}}
                    <option value="{{listcerttypeid}}" option selected="" id="{{listcerttypename}}" size="35">{{listcerttypename}}</option>
                {{/each}}
            </select>
        </div>

        <script type="text/javascript">
        document.getElementById("{{certtypename}}").selected = "Selected";
        </script>

        <div class="form-inline">
            <label for="date3" class="col-sm-0 col-form-label mb-2 mr-sm-2">Start Date</label>
            <div class="form-inline col-sm-3">
                <input type="date" name="start_date" id="date" class="form-control mb-2 mr-sm-2" value="{{{sdate}}}">
            </div>
            <label for="expiry_date" class="col-sm-0 col-form-label mb-2 mr-sm-2">Expiry Date</label>
            <div class="form-inline col-sm-2">
                <input type="date" name="expiry_date" id="expiry_date" class="form-control mb-2 mr-sm-2" value="{{{edate}}}">
            </div>
        </div>
        
        <br>
        <div class="form-group row">
            <label for="leadtime" class="col-sm-2 col-form-label mb-2 mr-sm-2">Lead Time Days </label>
            <div class="col-sm-0">
                <input type="text" name="leadtime" id="leadtime" class="form-control mb-1" size=2px value="{{{leadTime}}}">
            </div>
        </div>

        <div class="form-inline">
            <label for="certRevoked" class="col-sm-0 col-form-label mb-2 mr-sm-2">Revoked</label>
            <div class="form-inline col-sm-1">
                <input type="checkbox" name = "certRevoked" id="certRevoked" value="1" onClick = "JavaScript:toggleVisibility(this,'certRevokedDate');" {{{certRevoked}}}>
            </div>
                <input type="date" name="certRevokedDate" id="certRevokedDate" class="form-control mb-1" value="{{{certRevokedDate}}}"><br>
        </div>
    <br>
        <div class="form-inline">
            <label for="name" class="col-sm-0 col-form-label mb-2 mr-sm-2">Cert file:</label>
            <div class="col-sm-3">
                <input type="text" name="currentCertFile" id="currentCertFile" class="" value="{{{certfile}}}" />
            </div>    
                <input type="file" name="newcertfile" id="newcertfile" class="">
        </div>

        <div class="form-group row">
            <label for="changeref" class="col-sm-2 col-form-label mb-2 mr-sm-2">Project</label>
            <div class="col-sm-3">
                <input type="text" name="contact" id="contact" class="form-control mb-2 mr-sm-2" readonly value="{{{projectname}}}">
            </div>
        </div>   

        <div class="form-group row">
            <label for="changeref" class="col-sm-2 col-form-label mb-2 mr-sm-2">Contact</label>
            <div class="col-sm-3">
                <input type="text" name="contact" id="contact" class="form-control mb-2 mr-sm-2" readonly value="{{{userEmail}}}">
            </div>
        </div>   

        <table class ="table table-bordered table-striped">
            <thead class ="thead-dark">
                <tr>
                <th>Device</th>
                <th>Delete</th>
                </tr>
            </thead>
            <tbody id="projects" class="collection with-header">
            {{#each certdevices}}
                <tr class="{{classtype}}">
                    <td>{{deviceName}}</td>
                    <td><input type="checkbox" id="removecert_cert" name="deldevice" value="{{{deviceid}}}"></td>
                </tr>
            {{/each}}
            </tbody>
        </table>

<div class="container jf-form">
<form data-licenseKey="" name="jqueryform-4d4fe5" id="jqueryform-4d4fe5" action='postcert' method='post' enctype='multipart/form-data' novalidate autocomplete="on">
<input type="hidden" name="method" value="validateForm">
<input type="hidden" id="serverValidationFields" name="serverValidationFields" value="">
<div class="form-group f2 required" data-fid="f2"></div>

<div class="form-group certdevice " data-fid="certdevice">
  <label class="control-label" for="certdevice">Device</label>
<select class="form-control" id="certdevice" name="certdevice" multiple="multiple">
      {{#each devices}}
        <option value="{{deviceid}}">{{devicename}}</option>
      {{/each}}
</select>
</div>

    <br><input type="submit" value='Submit'>
    
</form>
</div>
</div>

<!-- ----------------------------------------------- -->

        <style type="text/css">
            #certRevokedDate{visibility:{{revokedVis}};}
        </style>
        <script language="JavaScript">

            function toggleVisibility(eventsender, certRevokedDate){
                var myNewState = "hidden";
                if (eventsender.checked === true){
                    myNewState = "visible";
                }

                document.getElementById(certRevokedDate).style.visibility = myNewState;
            }       
        </script>

        <!-- [ Start: Select2 support ] ---------------------------------- -->
<link rel="stylesheet" type="text/css" href="/modules/select2/dist/css/select2.min.css">
<script type="text/javascript" src="/modules/select2/dist/js/select2.full.min.js"></script>
<style type="text/css">
.select2-hidden-accessible{
	opacity: 0;
    width:1% !important;
}
.select2-container .select2-selection--single{
  height: 34px;
  padding-top: 2px;
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
  border: 1px solid #ccc;
}
.select2-container--default .select2-selection--single .select2-selection__arrow{
  top: 4px;
}
</style>
<script type="text/javascript">
;(function(){
	
	function templateResult (obj) {
	  if (!obj.id) { return obj.text; }

	  var img = $(obj.element).data('imgSrc');
	  if( img ){
	    return $( '<span><img src="' + img + '" class="img-flag" /> ' + obj.text + '</span>' );
	  };

	  return obj.text;
	};
	 
	$(".jf-form select").css('width', '100%'); // make it responsive
	$(".jf-form select").select2({
	  templateResult: templateResult
	}).change( function(e){
	  $(e.target).valid();
	});

})();
</script>
<!-- [ End: Select2 support ] ---------------------------------- -->


<script type="text/javascript">

	// start jqueryform initialization
	// --------------------------------
	JF.init('#jqueryform-4d4fe5');

	// watch form element change event to run jqueryform's formlogic
	// ---------------------------------------------------------------
	var logics = [
    {
        "disabled": false,
        "action": "",
        "selector": "",
        "match": "",
        "rules": []
    }
];
	$('input,input:radio,select').change(function(){
		$.formlogic( {logics: logics} );
	});
</script>
</body>